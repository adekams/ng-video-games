<div class="ui container game-detail-wrapper">
  <!-- Header with Back Button -->
  <div class="header-section">
    <a routerLink="/all-games" class="ui button">
      <i class="left arrow icon"></i> Back
    </a>
    <h1 class="game-title">{{ game?.name }}</h1>
  </div>

  <!-- Game Details Card -->
  <div class="ui segment" *ngIf="game">
    <!-- Hero Image -->
    <div class="bg-img">
      <img
        *ngIf="game?.background_image"
        [src]="game?.background_image"
        [alt]="game?.name"
      />
      <img
        *ngIf="!game?.background_image"
        src="https://res.cloudinary.com/adenike/image/upload/v1642002314/no-image_iah8ux.png"
        alt="No image available"
      />
    </div>

    <!-- Game Info Grid -->
    <div class="game-info-grid">
      <!-- Rating Card -->
      <div class="info-card">
        <p class="header-text primary">Rating</p>
        <p class="body-text medium">
          {{ game?.rating }}
          <span class="rating-star"><i class="star icon"></i></span>
        </p>
      </div>

      <!-- Release Date Card -->
      <div class="info-card">
        <p class="header-text secondary">Released</p>
        <p class="body-text medium">
          {{ game?.released | date: "dd MMM yyyy" }}
        </p>
      </div>

      <!-- Review Count Card -->
      <div class="info-card">
        <p class="header-text primary">Reviews</p>
        <p class="body-text medium">{{ game?.reviews_count }}</p>
      </div>

      <!-- Updated Card -->
      <div class="info-card">
        <p class="header-text secondary">Updated</p>
        <p class="body-text medium">
          {{ game?.updated | date: "dd MMM yyyy" }}
        </p>
      </div>
    </div>

    <!-- Genres Section -->
    <div class="genres-section">
      <h2 class="genres-title">Genres</h2>
      <div class="genres-container">
        <span *ngIf="game?.genres?.length; else noGenres">
          <span *ngFor="let genre of game?.genres" class="genre-item">
            {{ genre?.name }}
          </span>
        </span>
        <ng-template #noGenres>
          <span class="no-genres-text">No genres info</span>
        </ng-template>
      </div>
    </div>

    <!-- Platforms Section -->
    <div class="platforms-section">
      <h2 class="platforms-title">Platforms</h2>
      <div class="platforms-container">
        @if (game?.parent_platforms?.length) {
          <span
            *ngFor="let platform of game?.parent_platforms"
            class="platform-item"
          >
            {{ platform?.platform?.name }}
          </span>
        } @else {
          <span class="no-platforms-text">No platform info</span>
        }
      </div>
    </div>

    <!-- Ratings -->
    <div class="rating-section" *ngIf="game?.ratings?.length">
      <h2 class="rating-title">Ratings</h2>
      <div class="rating-grid">
        <div
          *ngFor="let rating of game?.ratings; let last = last"
          class="rating-row-container"
          [style.--rating-color]="getRatingColor(rating?.title)"
        >
          <div class="rating-label-wrapper">
            <span class="rating-label-text">
              {{ rating?.title }}
            </span>
          </div>

          <!-- Progress Bar with Percentage -->
          <div class="rating-bar-container">
            <div
              class="rating-bar-fill"
              [style.--percent]="getRatingPercentage(rating) + '%'"
            >
              <span
                class="rating-percentage-text"
                *ngIf="getRatingPercentage(rating) > 15"
              >
                {{ getRatingPercentage(rating) }}%
              </span>
            </div>
            <span
              class="rating-percentage-absolute"
              *ngIf="getRatingPercentage(rating) <= 15"
            >
              {{ getRatingPercentage(rating) }}%
            </span>
          </div>

          <div class="rating-count-wrapper">
            <span class="rating-count-text">
              {{ rating?.count }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Tags -->
    <div class="tags-section">
      <h2 class="tags-title">Tags</h2>
      <div class="tags-container">
        <span
          *ngFor="let tag of game?.tags?.slice(0, 20) || []"
          class="tag-item"
          (mouseenter)="onTagHover($event, true)"
          (mouseleave)="onTagHover($event, false)"
        >
          {{ tag.name }}
        </span>
        <span *ngIf="(game?.tags?.length || 0) > 20" class="tags-more-text">
          +{{ (game?.tags?.length || 0) - 20 }} more
        </span>
      </div>
    </div>

    <!-- Screenshots Section with Expandable Gallery -->
    <section
      class="screenshots-section"
      *ngIf="game?.short_screenshots?.length"
    >
      <h2 class="screenshots-title">Screenshots</h2>
      <div class="screenshots-grid">
        <ng-container
          *ngFor="let item of game?.short_screenshots; let i = index"
        >
          <div
            class="screenshot-item"
            (click)="openScreenshot(i)"
            [attr.data-index]="i"
          >
            <img
              [src]="item?.image"
              [alt]="'Screenshot of ' + game?.name"
              loading="lazy"
            />
            <div class="screenshot-overlay">
              <div class="expand-icon">â¤¢</div>
            </div>
          </div>
        </ng-container>
      </div>
    </section>
  </div>

  <!-- Screenshot Modal/Lightbox with Swipe Support -->
  <div
    class="screenshot-modal"
    [class.active]="isModalOpen"
    *ngIf="isModalOpen"
  >
    <!-- Modal Overlay (Close on Click) -->
    <div class="modal-overlay" (click)="closeModal()"></div>

    <!-- Modal Content -->
    <div class="modal-content">
      <!-- Close Button (Above image) -->
      <button
        class="modal-close-btn"
        (click)="closeModal()"
        aria-label="Close modal"
      >
        &times;
      </button>

      <!-- Main Image Container with Smooth Transitions -->
      <div class="modal-image-container">
        <img
          *ngIf="game?.short_screenshots?.[selectedScreenshotIndex]"
          [src]="game.short_screenshots[selectedScreenshotIndex].image"
          [alt]="'Screenshot ' + (selectedScreenshotIndex + 1)"
          class="modal-image"
          [class.transitioning]="isTransitioning"
        />
      </div>

      <!-- Image Counter -->
      <div class="modal-counter" *ngIf="game?.short_screenshots?.length > 1">
        {{ selectedScreenshotIndex + 1 }} /
        {{ game?.short_screenshots?.length }}
      </div>

      <!-- Thumbnail Strip -->
      <div class="modal-thumbnails" *ngIf="game?.short_screenshots?.length > 1">
        <div
          *ngFor="let item of game?.short_screenshots; let i = index"
          class="thumbnail-item"
          [class.active]="i === selectedScreenshotIndex"
          (click)="selectedScreenshotIndex = i"
        >
          <img [src]="item?.image" [alt]="'Thumbnail ' + (i + 1)" />
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state-container" *ngIf="!game">
    <h2 class="empty-state-title">No game selected</h2>
    <p class="empty-state-text">
      Please select a game from the list to view details
    </p>
    <a routerLink="/all-games" class="ui primary button empty-state-button">
      Go to Games List
    </a>
  </div>
</div>
